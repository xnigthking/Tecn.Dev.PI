// ===============================
// ğŸŒ MundoFitness - Servidor API (modo CommonJS)
// ===============================

const express = require("express");
const cors = require("cors");
const dotenv = require("dotenv");
const sequelize = require("./src/config/database");
const usuarioRoutes = require("./src/routes/usuarioRoutes");
const treinoRoutes = require("./src/routes/treinoRoutes");
const refeicaoRoutes = require("./src/routes/refeicaoRoutes");
const hidratacaoRoutes = require("./src/routes/hidratacaoRoutes");
const habitoRoutes = require("./src/routes/habitoRoutes");
const lembreteRoutes = require("./src/routes/lembreteRoutes");
const newsletterRoutes = require("./src/routes/newsletterRoutes");

dotenv.config();
const app = express();

app.use(cors());
app.use(express.json());

// Rotas principais
app.use("/api/usuarios", usuarioRoutes);
app.use("/api/treinos", treinoRoutes);
app.use("/api/refeicoes", refeicaoRoutes);
app.use("/api/hidratacao", hidratacaoRoutes);
app.use("/api/habitos", habitoRoutes);
app.use("/api/lembretes", lembreteRoutes);
app.use("/api/newsletter", newsletterRoutes);

// Rota padrÃ£o
app.get("/", (req, res) => {
  res.send("ğŸ’ª API MundoFitness estÃ¡ online!");
});

// InicializaÃ§Ã£o do servidor
const PORT = process.env.PORT || 3007;
app.listen(PORT, async () => {
  try {
    await sequelize.authenticate();
    console.log("âœ… Banco de dados conectado com sucesso!");
    console.log(`ğŸš€ Servidor rodando na porta ${PORT}`);
  } catch (err) {
    console.error("âŒ Erro ao conectar no banco:", err.message);
  }
});
